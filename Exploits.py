import urllib.request
import re
import sys
import datetime
from openpyxl import Workbook


def DBexploit():
    
    for query in cves:
        if not query == "":
            data = "https://www.exploit-db.com/search/?action=search&cve="+query+"&e_author="
            web = urllib.request.urlopen(data)
            d = str(web.read())
            d1 =  re.search(r"No results", d)
            if not d1:
                print(data)
                enlace.append(data)
               
            else:
                enlace.append("n/a")
                
            

def busqueda():
    while True:
        busqueda =  input("CVE a buscar: ")
        cves.append(busqueda)
        if busqueda == "":
            print ("DBexploit:")
            DBexploit()
            Excel()
            break
        
        print ("Listado de Webs a buscar: ")        
        print (cves)

def Webtxt():
    cved = open("CVEdic.txt","r")
    lineas = cved.readlines()
    cved.close()
    for line in lineas:
        line = line.strip("\n")
        print (line)
        cves.append(line)
    print ("Estas son las URLs que vamos a analizar: ")
    r =  input("EstÃ¡s de acuerdo?: [y/n] ")
    if r == "y":
        print ("DBexploit:")
        DBexploit()
        print ("Creating Excel: ")
        Excel()
    elif r == "n":
        Main()

    else:
        print ("Esto tampoco ha salido como pensabas")

def Excel():
    wb = Workbook()
    ws = wb.active
    a = 1
    e = 1
    for resultado in cves:
        
        a += 1
        ws["A1"] = "CVE"
        
        a1 = ("A"+ str(a))
        ws[str(a1)] =  resultado
   
    for url in enlace:
        e += 1
        ws["B1"] = "Exploit URL"
        e1 = ("B"+str(e))
        ws[e1] = url
        
    wb.save("Reportcve.xlsx")
    
def Main():
    
    print(" _________________________________________ ")
    print("|                                         |")
    print("| 1: Busqueda manual                      |")
    print("| 2: Agregar listas de webs mediante .txt |")
    print("|_________________________________________|")
    print("")

   
    m =  input("Selecciona una opciÃ³n: ")
    if m == "1":
        busqueda()
        
    elif m == "2":
        Webtxt()
    else:
        print("Algo no ha salido como esperabas")

if __name__ == "__main__":
    
    cves = []
    enlace = []
    x = datetime.datetime.now()
    Main()
    print ("Scan hecho el dia --> " + str(x))
    input("dale a [Enter] para salir:")


